<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.giantlizardcloud.merchant.mapper.SettleMapper">

    <resultMap id="getSettle" type="com.giantlizardcloud.merchant.vo.SettleWithAnnexVo">
        <id column="settle_id" property="settleId"></id>
        <result column="settle_number" property="settleNumber"></result>
        <result column="client_id" property="clientId"></result>
        <result column="settle_sum" property="settleSum"></result>
        <result column="settle_status" property="settleStatus"></result>
        <result column="settle_method" property="settleMethod"></result>
        <result column="settle_account_number" property="settleAccountNumber"></result>
        <result column="settle_date" property="settleDate"></result>
        <result column="settle_remark" property="settleRemark"></result>
        <result column="insert_user" property="insertUser"></result>
        <result column="insert_time" property="insertTime"></result>
        <result column="settle_invalid_user" property="settleInvalidUser"></result>
        <result column="settle_invalid_time" property="settleInvalidTime"></result>
        <collection property="children" ofType="string"
                    select="com.giantlizardcloud.merchant.mapper.SettleAnnexMapper.getAllAnnexBySettleId" column="settle_id">
        </collection>
    </resultMap>

    <sql id="getAllColumn">
        SELECT
            settle_id,
            settle_number,
            client_id,
            settle_sum,
            settle_status,
            settle_method,
            settle_account_number,
            settle_date,
            settle_remark,
            insert_user,
            insert_time,
            settle_invalid_user,
            settle_invalid_time
        FROM
            merchant_settle
        WHERE 1=1
    </sql>

    <select id="getSettleByCondition" resultMap="getSettle">
        <include refid="getAllColumn"></include>
        <if test=" settleNumber != '' and  settleNumber != null">
            AND settle_number = #{settleNumber}
        </if>
        <if test=" clientId != '' and  clientId != null">
            AND client_id = #{clientId}
        </if>
        <if test=" settleStatus != '' and  settleStatus != null">
            AND settle_status = #{settleStatus}
        </if>
        <if test=" settleMethod != '' and  settleMethod != null">
            AND settle_method = #{settleMethod}
        </if>
        <if test=" settleStartDate != '' and  settleStartDate != null
            and settleEndDate != '' and  settleEndDate != null">
            AND settle_date BETWEEN #{settleStartDate} AND #{settleEndDate}
        </if>
        ORDER BY settle_date desc
        LIMIT #{page},#{size}
    </select>
</mapper>
